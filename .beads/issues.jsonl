{"id":"para_plugin-5wn","title":"Reduce redundant path normalization","description":"## Problem\nPaths get normalized multiple times throughout the codebase:\n\n1. In `src/settings.ts:36,49` - paths are trimmed and trailing slashes removed on save\n2. In `src/main.ts:31,59,140` - paths are normalized again with Obsidian's `normalizePath()`\n3. In `src/utils.ts:39-40,73` - paths are normalized again with `normalizePathPure()`\n\n## Impact\n- Minor performance overhead (negligible for this use case)\n- Code noise and potential confusion about which normalization is authoritative\n- If normalizers diverge in behavior, subtle bugs could occur\n\n## Suggested Fix\nNormalize once at settings load/save time, then trust the stored value is normalized:\n\n1. Keep the `trim().replace(/\\/+$/, '')` in settings onChange\n2. Remove redundant `normalizePath()` calls in main.ts where value comes from settings\n3. Update `isTopLevelProjectFolder` to document that it expects pre-normalized paths, OR remove its internal normalization\n\n## Files\n- src/settings.ts:36,49\n- src/main.ts:31,59,140\n- src/utils.ts:39-40,73","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T13:12:42.397049-06:00","created_by":"zain","updated_at":"2026-01-06T13:19:06.573446-06:00","closed_at":"2026-01-06T13:19:06.573446-06:00","close_reason":"Documented instead of removing - defense in depth"}
{"id":"para_plugin-6au","title":"Add optional confirmation dialog before archiving","description":"## Problem\nArchiving is a one-click action with no confirmation. While reversible (manually move folder back), users might accidentally archive a project.\n\n## User Story\nAs a user, I want to optionally see a confirmation dialog before archiving, so that I don't accidentally archive important projects.\n\n## Suggested Implementation\n1. Add a new setting `confirmBeforeArchive: boolean` (default: false to preserve current behavior)\n2. In `archiveFolder()`, check the setting and show a modal if enabled\n3. Use Obsidian's `Modal` class for the confirmation dialog\n4. Dialog should show: project name, destination path, and confirm/cancel buttons\n\n## Alternative: Undo Notice\nInstead of confirmation, could show a Notice with an 'Undo' button that has a ~5 second timeout. This is less intrusive but more complex to implement (need to track the move and reverse it).\n\n## Files to Modify\n- src/settings.ts - add new setting\n- src/main.ts - add confirmation modal logic\n\n## Acceptance Criteria\n- [ ] New toggle in settings: 'Confirm before archiving'\n- [ ] When enabled, shows modal with project name and destination\n- [ ] Can cancel to abort archive\n- [ ] When disabled, archives immediately (current behavior)","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-06T13:13:03.782642-06:00","created_by":"zain","updated_at":"2026-01-06T13:13:03.782642-06:00"}
{"id":"para_plugin-8vt","title":"ensureFolderExists should verify path is actually a folder","description":"## Problem\nIn `src/main.ts:109-117`, the `ensureFolderExists()` method checks if something exists at the path, but doesn't verify it's actually a folder:\n\n```typescript\nprivate async ensureFolderExists(folderPath: string): Promise\u003cvoid\u003e {\n  const folder = this.app.vault.getAbstractFileByPath(folderPath);\n  if (!folder) {\n    await this.app.vault.createFolder(folderPath);\n  }\n}\n```\n\n## Impact\nIf a user has a FILE named 'Archive' instead of a folder, this method returns without error. Then `vault.rename()` fails with a confusing error when trying to move the project into it.\n\n## Fix\nAdd an `instanceof TFolder` check and throw a clear error:\n\n```typescript\nif (!folder) {\n  await this.app.vault.createFolder(folderPath);\n} else if (!(folder instanceof TFolder)) {\n  throw new Error(`\"${folderPath}\" exists but is not a folder`);\n}\n```\n\n## Files\n- src/main.ts:109-117","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:11:42.495697-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.331695-06:00","closed_at":"2026-01-06T13:15:31.331695-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-9ia","title":"Document undocumented internal API usage in focusProjectsFolder","description":"## Problem\nIn `src/main.ts:154-161`, the `focusProjectsFolder()` method uses an undocumented internal Obsidian API:\n\n```typescript\nconst fileExplorerView = fileExplorer.view as {\n  revealInFolder?: (file: TFolder) =\u003e void;\n};\n\nif (typeof fileExplorerView.revealInFolder === 'function') {\n  fileExplorerView.revealInFolder(projectsFolder as TFolder);\n}\n```\n\n`revealInFolder` is not part of Obsidian's public API and could break in future Obsidian updates.\n\n## Current Mitigation\n- Method is wrapped in try/catch\n- Comment marks it as 'best-effort'\n- Uses optional chaining to check if method exists\n\n## Suggested Improvements\n1. Add a comment noting which Obsidian version this was tested on\n2. Consider adding to CLAUDE.md as a known fragile area\n3. Monitor Obsidian changelogs for public API alternatives\n4. Could add Obsidian version check if API location changes\n\n## Files\n- src/main.ts:138-161","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-06T13:12:25.235609-06:00","created_by":"zain","updated_at":"2026-01-06T13:16:16.893487-06:00","closed_at":"2026-01-06T13:16:16.893487-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-c7x","title":"Document normalizer coupling between utils.ts and Obsidian API","description":"## Problem\nIn `src/main.ts:32`, `isTopLevelProjectFolder()` is called with:\n- `file.path` - raw path from Obsidian\n- `projectsPath` - already normalized via Obsidian's `normalizePath()`\n\nBut `isTopLevelProjectFolder()` in `src/utils.ts:35-45` applies its own `normalizePathPure()` to both arguments.\n\n## Risk\nIf Obsidian's `normalizePath` and our `normalizePathPure` behave differently in edge cases (e.g., unicode normalization, special characters), the comparison could fail unexpectedly.\n\n## Current State\nBoth implementations currently align in behavior for common cases:\n- Trim leading/trailing slashes\n- Collapse multiple slashes\n- Convert backslashes to forward slashes\n\n## Suggested Improvements\n1. Add a comment in utils.ts documenting this assumption\n2. Add test cases that verify `normalizePathPure` matches Obsidian's behavior for edge cases\n3. Consider having `isTopLevelProjectFolder` accept a flag indicating paths are pre-normalized\n\n## Files\n- src/main.ts:31-32\n- src/utils.ts:35-45","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T13:12:52.544469-06:00","created_by":"zain","updated_at":"2026-01-06T13:18:12.434517-06:00","closed_at":"2026-01-06T13:18:12.434517-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-huu","title":"Add afterEach to restore timers in vitest tests","description":"## Problem\nIn `tests/utils.test.ts:133-137`, the `generateArchiveDestination` test suite uses fake timers but never restores them:\n\n```typescript\ndescribe('generateArchiveDestination', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2024-03-15T12:00:00Z'));\n  });\n  // Missing: afterEach(() =\u003e vi.useRealTimers());\n```\n\n## Impact\nFake timers leak into subsequent test files if test order changes or new test files are added. This can cause flaky tests that are hard to debug.\n\n## Fix\nAdd afterEach cleanup:\n\n```typescript\nafterEach(() =\u003e {\n  vi.useRealTimers();\n});\n```\n\nOr use `vi.restoreAllMocks()` if other mocks are added later.\n\n## Files\n- tests/utils.test.ts:133-137","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:11:55.277708-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.330377-06:00","closed_at":"2026-01-06T13:15:31.330377-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-ive","title":"Make onClick handler explicitly async","description":"## Problem\nIn `src/main.ts:40`, the onClick handler returns a Promise but isn't marked async:\n\n```typescript\n.onClick(() =\u003e this.archiveFolder(file));\n```\n\nThis returns a Promise that Obsidian ignores. It works, but the intent is unclear.\n\n## Suggested Fix\nEither make it explicitly async (if we want to await):\n```typescript\n.onClick(async () =\u003e {\n  await this.archiveFolder(file);\n});\n```\n\nOr use void to indicate fire-and-forget:\n```typescript\n.onClick(() =\u003e {\n  void this.archiveFolder(file);\n});\n```\n\nThe first option is preferred as it matches the pattern used elsewhere in the codebase.\n\n## Files\n- src/main.ts:40","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:13:49.170034-06:00","created_by":"zain","updated_at":"2026-01-06T13:16:46.030274-06:00","closed_at":"2026-01-06T13:16:46.030274-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-l5y","title":"Validate that Archive folder differs from Projects folder","description":"## Problem\nUsers can set both `projectsPath` and `archivePath` to the same value (e.g., both 'Projects'). This causes undefined behavior - archiving a project would try to move it into its parent folder, potentially causing conflicts or weird nesting.\n\n## Reproduction\n1. Open plugin settings\n2. Set 'Projects folder' to 'Projects'\n3. Set 'Archive folder' to 'Projects'\n4. Try to archive a project\n5. Behavior is undefined/confusing\n\n## Suggested Fix\nAdd validation in one of these places:\n\n**Option A: Validate on settings save**\n```typescript\n.onChange(async (value) =\u003e {\n  const normalized = value.trim().replace(/\\/+$/, '') || 'Archive';\n  if (normalized === this.plugin.settings.projectsPath) {\n    new Notice('Archive folder cannot be the same as Projects folder');\n    return; // Don't save\n  }\n  this.plugin.settings.archivePath = normalized;\n  await this.plugin.saveSettings();\n})\n```\n\n**Option B: Validate at archive time**\nIn `archiveFolder()`, check before proceeding and show error Notice.\n\nOption A is better UX - prevents invalid state from being saved.\n\n## Files\n- src/settings.ts:48-51\n\n## Acceptance Criteria\n- [ ] Cannot save settings where projectsPath === archivePath\n- [ ] User sees clear error message explaining why\n- [ ] Existing users with invalid config see error on first archive attempt","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T13:13:15.157332-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.332765-06:00","closed_at":"2026-01-06T13:15:31.332765-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-p98","title":"Document versions.json format in CLAUDE.md","description":"## Problem\nThe `versions.json` file contains:\n```json\n{ \"1.0.0\": \"1.0.0\" }\n```\n\nThis maps plugin version to minimum Obsidian version, but this isn't documented anywhere in the project.\n\n## Context\nThis is standard Obsidian plugin convention:\n- Key: plugin version\n- Value: minimum Obsidian version required for that plugin version\n\nWhen users on older Obsidian versions try to install, Obsidian uses this to warn about compatibility.\n\n## Suggested Fix\nAdd explanation to CLAUDE.md in a 'Plugin Files' section:\n\n```markdown\n## Plugin Files\n\n### versions.json\nMaps plugin versions to minimum required Obsidian versions.\nFormat: `{ \"plugin_version\": \"min_obsidian_version\" }`\nUpdate this when releasing new versions that require newer Obsidian APIs.\n```\n\n## Files\n- CLAUDE.md\n- versions.json (reference only)","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:14:10.119337-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.333916-06:00","closed_at":"2026-01-06T13:15:31.333916-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-uvy","title":"Extract magic number MAX_COLLISION_ATTEMPTS to named constant","description":"## Problem\nIn `src/utils.ts:100`, there's a magic number:\n\n```typescript\nif (counter \u003e 1000) {\n  throw new Error('Too many archive collisions...');\n}\n```\n\nAnd in `src/main.ts:79`:\n```typescript\nconst maxRetries = 3;\n```\n\n## Suggested Fix\nExtract to named constants at the top of each file:\n\n```typescript\n// utils.ts\nconst MAX_COLLISION_ATTEMPTS = 1000;\n\n// main.ts  \nconst MAX_RENAME_RETRIES = 3;\n```\n\nThis makes the code more self-documenting and easier to adjust if needed.\n\n## Files\n- src/utils.ts:100\n- src/main.ts:79","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:13:57.497073-06:00","created_by":"zain","updated_at":"2026-01-06T13:17:31.060544-06:00","closed_at":"2026-01-06T13:17:31.060544-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-v4b","title":"Expand test coverage for error paths and edge cases","description":"## Current State\nThe plugin has 27 unit tests covering all pure utility functions in `src/utils.ts`:\n- normalizePathPure (7 tests)\n- getParentPath (4 tests)\n- isTopLevelProjectFolder (6 tests)\n- getFolderName (4 tests)\n- generateArchiveDestination (6 tests)\n\n## Gaps\nThe following are NOT unit-tested (they involve Obsidian API and would need mocking):\n\n1. **ensureFolderExists behavior**\n   - When folder exists\n   - When folder doesn't exist (creates it)\n   - When file exists at path (should error - see para_plugin-8vt)\n\n2. **archiveFolder error paths**\n   - Archive folder creation fails\n   - Rename fails after max retries\n   - Settings have invalid paths\n\n3. **Settings persistence**\n   - Settings load correctly on plugin start\n   - Settings save correctly on change\n   - Default values applied for missing settings\n\n4. **getExistingArchivePaths**\n   - Returns correct Set of child paths\n   - Handles empty archive folder\n   - Handles non-existent archive folder\n\n## Suggested Approach\nFor Obsidian API testing, consider:\n1. Creating mock objects for `app.vault`, `app.workspace`\n2. Using dependency injection to allow test doubles\n3. Or accepting that integration testing happens manually in Obsidian\n\n## Files\n- tests/utils.test.ts (existing)\n- tests/main.test.ts (to create)\n- tests/mocks/obsidian.ts (to create if mocking)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T13:13:28.934879-06:00","created_by":"zain","updated_at":"2026-01-06T13:13:28.934879-06:00"}
