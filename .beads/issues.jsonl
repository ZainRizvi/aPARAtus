{"id":"para_plugin-090","title":"Remove unused TFile import and clarify archiving scope","description":"## Problem\nsrc/main.ts:1 imports TFile but the code intentionally handles TAbstractFile generically now. The import is used in the instanceof check on line 92.\n\nLooking at the code:\n```typescript\nif (!(file instanceof TFolder) \u0026\u0026 !(file instanceof TFile)) {\n  return;\n}\n```\n\nThis allows archiving both folders AND files. This appears intentional (method renamed to archiveItem), but need to confirm the check is correct.\n\n## Analysis\nThe check should be: allow TFolder and TFile (which are the concrete types). TAbstractFile is abstract.\nCurrent code is correct - it filters out anything that's not a folder or file.\n\n## Verdict\nThe import IS used on line 92. No change needed for the import.\n\nHowever, the original spec said 'folders only'. If files should NOT be archivable, change line 92 to:\n```typescript\nif (!(file instanceof TFolder)) {\n  return;\n}\n```\n\nAnd remove TFile from imports.\n\n## Decision Needed\nThis is a feature scope question. For now, KEEP the current behavior (files archivable) since:\n1. The code was deliberately refactored to use archiveItem\n2. It's a superset of functionality\n3. README will be updated to reflect this\n\nMark this task as 'wont-fix' - behavior is intentional.\n\n## Files\n- src/main.ts (no change needed)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:50:10.529488-06:00","created_by":"zain","updated_at":"2026-01-06T13:50:19.764141-06:00","closed_at":"2026-01-06T13:50:19.764141-06:00","close_reason":"Intentional behavior - files are archivable by design. README being updated to reflect this."}
{"id":"para_plugin-2f3","title":"Add support for archiving Areas and Resources (full PARA)","description":"## Feature\nExtend the plugin to support archiving from all PARA source folders, not just Projects.\n\n## Current State\n- Only `projectsPath` (default: 'Projects') is supported\n- Context menu and commands only work on items in Projects folder\n\n## Desired State\nSupport three source folders:\n- `projectsPath` (default: 'Projects') - existing\n- `areasPath` (default: 'Areas') - new\n- `resourcesPath` (default: 'Resources') - new\n\nAll three should be archivable to the single `archivePath` (default: 'Archive').\n\n## Changes Required\n\n### 1. Update Settings Interface (`src/settings.ts`)\n\n```typescript\nexport interface ArchiveProjectSettings {\n  projectsPath: string;\n  areasPath: string;      // NEW\n  resourcesPath: string;  // NEW\n  archivePath: string;\n  focusAfterArchive: boolean;\n  confirmBeforeArchive: boolean;\n}\n\nexport const DEFAULT_SETTINGS: ArchiveProjectSettings = {\n  projectsPath: 'Projects',\n  areasPath: 'Areas',           // NEW\n  resourcesPath: 'Resources',   // NEW\n  archivePath: 'Archive',\n  focusAfterArchive: true,\n  confirmBeforeArchive: false,\n};\n```\n\n### 2. Add Settings UI (`src/settings.ts`)\n\nAdd two new text inputs for areasPath and resourcesPath, with same validation pattern as existing paths (can't match archivePath or each other).\n\n### 3. Update Context Menu (`src/main.ts`)\n\nChange the file-menu handler to check if item is direct child of ANY source folder:\n\n```typescript\nthis.registerEvent(\n  this.app.workspace.on('file-menu', (menu, file) =\u003e {\n    if (!(file instanceof TFolder) \u0026\u0026 !(file instanceof TFile)) {\n      return;\n    }\n\n    const sourceFolders = this.getSourceFolders();\n    const isTopLevel = sourceFolders.some(src =\u003e \n      isTopLevelProjectFolder(file.path, src)\n    );\n    \n    if (!isTopLevel) return;\n\n    menu.addItem((item) =\u003e {\n      item.setTitle('Archive it').setIcon('archive').onClick(async () =\u003e {\n        await this.archiveItem(file);\n      });\n    });\n  })\n);\n```\n\n### 4. Add Helper Method (`src/main.ts`)\n\n```typescript\nprivate getSourceFolders(): string[] {\n  return [\n    normalizePath(this.settings.projectsPath),\n    normalizePath(this.settings.areasPath),\n    normalizePath(this.settings.resourcesPath),\n  ].filter(Boolean); // Filter out empty strings\n}\n```\n\n### 5. Update Settings Validation\n\nIn `loadSettings()` and settings onChange handlers, validate that:\n- No two source folders are the same\n- No source folder matches archivePath\n\n### 6. Update focusProjectsFolder\n\nConsider renaming to `focusSourceFolder` and making it focus the appropriate source folder based on where the item came from. Or keep simple and always focus projectsPath.\n\n## Dependencies\n- Should implement after para_plugin-rdh and para_plugin-vx8 (commands) since they set up `getSourceFolders()` pattern\n\n## Files\n- src/settings.ts (interface, defaults, UI)\n- src/main.ts (context menu, helper method, validation)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T13:41:27.304579-06:00","created_by":"zain","updated_at":"2026-01-06T14:22:54.503402-06:00","closed_at":"2026-01-06T14:22:54.503402-06:00","close_reason":"Full PARA support implemented (Projects, Areas, Resources)","dependencies":[{"issue_id":"para_plugin-2f3","depends_on_id":"para_plugin-rdh","type":"blocks","created_at":"2026-01-06T13:41:34.614756-06:00","created_by":"zain"},{"issue_id":"para_plugin-2f3","depends_on_id":"para_plugin-vx8","type":"blocks","created_at":"2026-01-06T13:41:34.651247-06:00","created_by":"zain"}]}
{"id":"para_plugin-4k7","title":"Support archiving files, not just folders","description":"## Current Behavior\nThe plugin only shows 'Archive it' context menu for folders. In `src/main.ts:65`:\n\n```typescript\nif (!(file instanceof TFolder)) {\n  return;\n}\n```\n\n## Desired Behavior\nShould support archiving both files AND folders that are direct children of projectsPath.\n\n## Changes Required\n\n1. **main.ts:65** - Check for TFolder OR TFile:\n```typescript\nimport { Modal, Notice, Plugin, TAbstractFile, TFile, TFolder, normalizePath } from 'obsidian';\n\n// In file-menu handler:\nif (!(file instanceof TFolder) \u0026\u0026 !(file instanceof TFile)) {\n  return;\n}\n```\n\n2. **main.ts:100** - Update archiveFolder signature to accept TAbstractFile:\n```typescript\nasync archiveFolder(file: TAbstractFile): Promise\u003cvoid\u003e {\n```\n(Consider renaming to `archiveItem` for clarity)\n\n3. **utils.ts:isTopLevelProjectFolder** - Already works for any path, no change needed\n\n4. **Naming** - Consider renaming throughout:\n   - `archiveFolder` → `archiveItem`\n   - `folderName` → `itemName`\n   - Variable names referencing 'folder'\n\n5. **UI text** - Update menu item and notices to say 'item' or detect type:\n   - 'Archive it' (current, generic - OK)\n   - Notice could say 'Archived file' vs 'Archived folder'\n\n## Files\n- src/main.ts:1 (imports)\n- src/main.ts:65 (type check)\n- src/main.ts:100+ (archiveFolder method and callers)\n- Possibly rename functions/variables throughout","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T13:26:50.795477-06:00","created_by":"zain","updated_at":"2026-01-06T13:33:18.061607-06:00","closed_at":"2026-01-06T13:33:18.061607-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-5rg","title":"Clean up modal keyboard event listener on close","description":"## Problem\nIn `src/main.ts:70`, the `ArchiveConfirmModal` adds a keydown event listener but never removes it in `onClose()`:\n\n```typescript\nonOpen() {\n  // ...\n  const handleKeydown = (e: KeyboardEvent) =\u003e { ... };\n  contentEl.addEventListener('keydown', handleKeydown);\n}\n\nonClose() {\n  const { contentEl } = this;\n  contentEl.empty();\n  // No removeEventListener!\n}\n```\n\n## Impact\nWhile Obsidian likely cleans up the DOM and its listeners, explicitly removing listeners is better practice and prevents potential memory leaks if the modal is opened/closed many times.\n\n## Fix\nStore the handler reference as a class property and remove it in onClose:\n\n```typescript\nprivate keydownHandler?: (e: KeyboardEvent) =\u003e void;\n\nonOpen() {\n  // ...\n  this.keydownHandler = (e: KeyboardEvent) =\u003e { ... };\n  contentEl.addEventListener('keydown', this.keydownHandler);\n}\n\nonClose() {\n  if (this.keydownHandler) {\n    this.contentEl.removeEventListener('keydown', this.keydownHandler);\n  }\n  this.contentEl.empty();\n  // ...\n}\n```\n\n## Files\n- src/main.ts:16-80 (ArchiveConfirmModal class)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T14:16:29.087859-06:00","created_by":"zain","updated_at":"2026-01-06T14:19:19.099815-06:00","closed_at":"2026-01-06T14:19:19.099815-06:00","close_reason":"Event listener cleanup implemented"}
{"id":"para_plugin-5wn","title":"Reduce redundant path normalization","description":"## Problem\nPaths get normalized multiple times throughout the codebase:\n\n1. In `src/settings.ts:36,49` - paths are trimmed and trailing slashes removed on save\n2. In `src/main.ts:31,59,140` - paths are normalized again with Obsidian's `normalizePath()`\n3. In `src/utils.ts:39-40,73` - paths are normalized again with `normalizePathPure()`\n\n## Impact\n- Minor performance overhead (negligible for this use case)\n- Code noise and potential confusion about which normalization is authoritative\n- If normalizers diverge in behavior, subtle bugs could occur\n\n## Suggested Fix\nNormalize once at settings load/save time, then trust the stored value is normalized:\n\n1. Keep the `trim().replace(/\\/+$/, '')` in settings onChange\n2. Remove redundant `normalizePath()` calls in main.ts where value comes from settings\n3. Update `isTopLevelProjectFolder` to document that it expects pre-normalized paths, OR remove its internal normalization\n\n## Files\n- src/settings.ts:36,49\n- src/main.ts:31,59,140\n- src/utils.ts:39-40,73","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T13:12:42.397049-06:00","created_by":"zain","updated_at":"2026-01-06T13:19:06.573446-06:00","closed_at":"2026-01-06T13:19:06.573446-06:00","close_reason":"Documented instead of removing - defense in depth"}
{"id":"para_plugin-6au","title":"Add optional confirmation dialog before archiving","description":"## Problem\nArchiving is a one-click action with no confirmation. While reversible (manually move folder back), users might accidentally archive a project.\n\n## User Story\nAs a user, I want to optionally see a confirmation dialog before archiving, so that I don't accidentally archive important projects.\n\n## Suggested Implementation\n1. Add a new setting `confirmBeforeArchive: boolean` (default: false to preserve current behavior)\n2. In `archiveFolder()`, check the setting and show a modal if enabled\n3. Use Obsidian's `Modal` class for the confirmation dialog\n4. Dialog should show: project name, destination path, and confirm/cancel buttons\n\n## Alternative: Undo Notice\nInstead of confirmation, could show a Notice with an 'Undo' button that has a ~5 second timeout. This is less intrusive but more complex to implement (need to track the move and reverse it).\n\n## Files to Modify\n- src/settings.ts - add new setting\n- src/main.ts - add confirmation modal logic\n\n## Acceptance Criteria\n- [ ] New toggle in settings: 'Confirm before archiving'\n- [ ] When enabled, shows modal with project name and destination\n- [ ] Can cancel to abort archive\n- [ ] When disabled, archives immediately (current behavior)","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-06T13:13:03.782642-06:00","created_by":"zain","updated_at":"2026-01-06T13:20:32.517642-06:00","closed_at":"2026-01-06T13:20:32.517642-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-73r","title":"Confirmation dialog shows path that might change on retry","description":"## Problem\nIn `src/main.ts:113-126`, the confirmation dialog shows `destPath` before archiving:\n\n```typescript\nconst destPath = generateArchiveDestination(...);\n\nif (this.settings.confirmBeforeArchive) {\n  new ArchiveConfirmModal(this.app, folderName, destPath, async () =\u003e {\n    await this.performArchive(folder, destPath, folderName, archivePath);\n  }).open();\n}\n```\n\nBut in `performArchive`, if rename fails due to case-insensitive collision, `destPath` gets regenerated:\n\n```typescript\ndestPath = generateArchiveDestination(archivePath, folderName, refreshedPaths);\n```\n\nUser sees 'Move to Archive/Foo' but might end up at 'Archive/Foo (Archived 2024-01-06)'.\n\n## Impact\nMinor UX confusion in edge case (case-insensitive collision after confirmation shown).\n\n## Possible Fixes\n1. **Accept it** - Very rare edge case, notice shows correct final path\n2. **Show notice if changed**: \n   ```typescript\n   if (finalPath !== originalDestPath) {\n     new Notice(`Note: Archived to ${finalPath} (destination changed due to conflict)`);\n   }\n   ```\n3. **Recalculate after confirm** - More complex, defeats pre-calculation purpose\n\nRecommend option 1 or 2.\n\n## Files\n- src/main.ts:113-126, 141-159","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-06T13:27:05.474241-06:00","created_by":"zain","updated_at":"2026-01-06T13:36:51.567808-06:00","closed_at":"2026-01-06T13:36:51.567808-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-77f","title":"Add keyboard accessibility to confirmation modal","description":"## Problem\nThe confirmation modal in `src/main.ts:28-44` lacks keyboard accessibility:\n- No focus management (confirm button should be focused)\n- No Enter key to confirm\n- Tab order not explicitly set\n\n## Suggested Fix\nIn `onOpen()`:\n\n```typescript\nonOpen() {\n  const { contentEl } = this;\n  contentEl.createEl('h2', { text: 'Archive Project?' });\n  contentEl.createEl('p', { text: `Move \"${this.folderName}\" to:` });\n  contentEl.createEl('p', { text: this.destPath, cls: 'archive-dest-path' });\n\n  const buttonContainer = contentEl.createDiv({ cls: 'modal-button-container' });\n\n  const cancelBtn = buttonContainer.createEl('button', { text: 'Cancel' });\n  cancelBtn.addEventListener('click', () =\u003e this.close());\n\n  const confirmBtn = buttonContainer.createEl('button', { text: 'Archive', cls: 'mod-cta' });\n  confirmBtn.addEventListener('click', () =\u003e {\n    this.onConfirm();\n    this.close();\n  });\n\n  // Focus confirm button for keyboard users\n  confirmBtn.focus();\n\n  // Handle Enter key\n  this.contentEl.addEventListener('keydown', (e) =\u003e {\n    if (e.key === 'Enter') {\n      this.onConfirm();\n      this.close();\n    }\n  });\n}\n```\n\n## Files\n- src/main.ts:28-44","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-06T13:27:41.064461-06:00","created_by":"zain","updated_at":"2026-01-06T13:36:09.10133-06:00","closed_at":"2026-01-06T13:36:09.10133-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-8vt","title":"ensureFolderExists should verify path is actually a folder","description":"## Problem\nIn `src/main.ts:109-117`, the `ensureFolderExists()` method checks if something exists at the path, but doesn't verify it's actually a folder:\n\n```typescript\nprivate async ensureFolderExists(folderPath: string): Promise\u003cvoid\u003e {\n  const folder = this.app.vault.getAbstractFileByPath(folderPath);\n  if (!folder) {\n    await this.app.vault.createFolder(folderPath);\n  }\n}\n```\n\n## Impact\nIf a user has a FILE named 'Archive' instead of a folder, this method returns without error. Then `vault.rename()` fails with a confusing error when trying to move the project into it.\n\n## Fix\nAdd an `instanceof TFolder` check and throw a clear error:\n\n```typescript\nif (!folder) {\n  await this.app.vault.createFolder(folderPath);\n} else if (!(folder instanceof TFolder)) {\n  throw new Error(`\"${folderPath}\" exists but is not a folder`);\n}\n```\n\n## Files\n- src/main.ts:109-117","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:11:42.495697-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.331695-06:00","closed_at":"2026-01-06T13:15:31.331695-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-9fx","title":"Fill in empty author fields in package.json and manifest.json","description":"## Problem\nBoth package.json and manifest.json have empty author fields, which should be filled before community plugin submission.\n\n## Current\npackage.json:24 - \"author\": \"\"\nmanifest.json:7-8 - \"author\": \"\", \"authorUrl\": \"\"\n\n## Fix\nUpdate both files with author information. Use a placeholder or generic value if personal info shouldn't be committed:\n\npackage.json:\n```json\n\"author\": \"Zain Ali\"\n```\n\nmanifest.json:\n```json\n\"author\": \"Zain Ali\",\n\"authorUrl\": \"\"\n```\n\nNote: authorUrl can remain empty if no public URL is desired.\n\n## Files\n- package.json\n- manifest.json","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:48:20.845678-06:00","created_by":"zain","updated_at":"2026-01-06T13:49:33.300885-06:00","closed_at":"2026-01-06T13:49:33.300885-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-9ia","title":"Document undocumented internal API usage in focusProjectsFolder","description":"## Problem\nIn `src/main.ts:154-161`, the `focusProjectsFolder()` method uses an undocumented internal Obsidian API:\n\n```typescript\nconst fileExplorerView = fileExplorer.view as {\n  revealInFolder?: (file: TFolder) =\u003e void;\n};\n\nif (typeof fileExplorerView.revealInFolder === 'function') {\n  fileExplorerView.revealInFolder(projectsFolder as TFolder);\n}\n```\n\n`revealInFolder` is not part of Obsidian's public API and could break in future Obsidian updates.\n\n## Current Mitigation\n- Method is wrapped in try/catch\n- Comment marks it as 'best-effort'\n- Uses optional chaining to check if method exists\n\n## Suggested Improvements\n1. Add a comment noting which Obsidian version this was tested on\n2. Consider adding to CLAUDE.md as a known fragile area\n3. Monitor Obsidian changelogs for public API alternatives\n4. Could add Obsidian version check if API location changes\n\n## Files\n- src/main.ts:138-161","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-06T13:12:25.235609-06:00","created_by":"zain","updated_at":"2026-01-06T13:16:16.893487-06:00","closed_at":"2026-01-06T13:16:16.893487-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-9kj","title":"Validate settings on load to catch manual data.json edits","description":"## Problem\nSettings validation (projectsPath !== archivePath) only runs in UI onChange handlers (`src/settings.ts:38-42, 56-60`).\n\nIf someone manually edits `.obsidian/plugins/archive-project/data.json` to set both paths the same, invalid settings load without validation.\n\n## Impact\nLow risk - manual JSON editing is rare. But defense-in-depth is good practice.\n\n## Fix\nAdd validation in `loadSettings()` in `src/main.ts:87-89`:\n\n```typescript\nasync loadSettings(): Promise\u003cvoid\u003e {\n  this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n  \n  // Validate loaded settings\n  if (this.settings.projectsPath === this.settings.archivePath) {\n    new Notice('Archive Project: Invalid settings detected (paths match), resetting to defaults');\n    this.settings.projectsPath = DEFAULT_SETTINGS.projectsPath;\n    this.settings.archivePath = DEFAULT_SETTINGS.archivePath;\n    await this.saveSettings();\n  }\n}\n```\n\n## Files\n- src/main.ts:87-89","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T13:27:17.216047-06:00","created_by":"zain","updated_at":"2026-01-06T13:35:28.41258-06:00","closed_at":"2026-01-06T13:35:28.41258-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-alu","title":"Update README test checklist to reflect file archiving support","description":"## Problem\nThe README manual test checklist at line 134-135 is outdated:\n\n```markdown\n- [ ] Right-click a file in Projects/ → \"Archive it\" does NOT appear\n```\n\nBut the plugin now supports archiving both files and folders (intentional behavior confirmed).\n\n## Fix\nUpdate line 135 from:\n```markdown\n- [ ] Right-click a file → \"Archive it\" does NOT appear\n```\n\nTo:\n```markdown\n- [ ] Right-click a file in Projects/ root → \"Archive it\" appears (files can be archived too)\n```\n\nThis matches the existing note at line 135 which already says '(files can be archived too)'.\n\nActually, looking at the current README, line 135 already says:\n```markdown\n- [ ] Right-click a file in Projects/ → \"Archive it\" appears (files can be archived too)\n```\n\nSo the README may already be correct. Verify and close if no change needed.\n\n## Files\n- README.md:134-135","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T14:16:52.834282-06:00","created_by":"zain","updated_at":"2026-01-06T14:19:19.126723-06:00","closed_at":"2026-01-06T14:19:19.126723-06:00","close_reason":"README already correct, no change needed"}
{"id":"para_plugin-b7d","title":"Update README with new settings and fix documentation inconsistencies","description":"## Problems\n1. README doesn't document the new 'confirmBeforeArchive' setting (added recently)\n2. Line 128 says files won't show Archive option, but code now allows archiving files\n3. README doesn't mention OBSIDIAN_TEST_VAULT env var for install script\n\n## Fixes Required\n\n1. Update settings table (around line 29-33) to add confirmBeforeArchive:\n```markdown\n| Setting | Default | Description |\n|---------|---------|-------------|\n| Projects folder | `Projects` | Path to your top-level projects folder |\n| Archive folder | `Archive` | Where archived projects are moved |\n| Focus after archive | `true` | Return focus to Projects folder after archiving |\n| Confirm before archive | `false` | Show confirmation dialog before archiving |\n```\n\n2. Update line 128 to reflect that files CAN be archived:\nChange: `- [ ] Right-click a file → \"Archive it\" does NOT appear`\nTo: `- [ ] Right-click a file in Projects/ → \"Archive it\" appears (files can be archived too)`\n\n3. Add env var documentation in the Development section (around line 92-95):\n```markdown\nOr set the OBSIDIAN_TEST_VAULT environment variable:\n\\`\\`\\`bash\nexport OBSIDIAN_TEST_VAULT=\"/path/to/your/vault\"\nnpm run install:dev\n\\`\\`\\`\n```\n\n## Files\n- README.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T13:50:09.245017-06:00","created_by":"zain","updated_at":"2026-01-06T13:51:18.010854-06:00","closed_at":"2026-01-06T13:51:18.010854-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-c7x","title":"Document normalizer coupling between utils.ts and Obsidian API","description":"## Problem\nIn `src/main.ts:32`, `isTopLevelProjectFolder()` is called with:\n- `file.path` - raw path from Obsidian\n- `projectsPath` - already normalized via Obsidian's `normalizePath()`\n\nBut `isTopLevelProjectFolder()` in `src/utils.ts:35-45` applies its own `normalizePathPure()` to both arguments.\n\n## Risk\nIf Obsidian's `normalizePath` and our `normalizePathPure` behave differently in edge cases (e.g., unicode normalization, special characters), the comparison could fail unexpectedly.\n\n## Current State\nBoth implementations currently align in behavior for common cases:\n- Trim leading/trailing slashes\n- Collapse multiple slashes\n- Convert backslashes to forward slashes\n\n## Suggested Improvements\n1. Add a comment in utils.ts documenting this assumption\n2. Add test cases that verify `normalizePathPure` matches Obsidian's behavior for edge cases\n3. Consider having `isTopLevelProjectFolder` accept a flag indicating paths are pre-normalized\n\n## Files\n- src/main.ts:31-32\n- src/utils.ts:35-45","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T13:12:52.544469-06:00","created_by":"zain","updated_at":"2026-01-06T13:18:12.434517-06:00","closed_at":"2026-01-06T13:18:12.434517-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-cv7","title":"Rename getFolderName to getItemName for clarity","description":"## Problem\nIn `src/utils.ts:60`, the function is named `getFolderName` but it's used for both files and folders:\n\n```typescript\nexport function getFolderName(folderPath: string): string {\n```\n\nIn `src/main.ts:141`:\n```typescript\nconst itemName = getFolderName(item.path); // item can be TFile or TFolder\n```\n\n## Suggested Fix\nRename to `getItemName` or `getBaseName` to accurately reflect its purpose:\n\n1. In `src/utils.ts`:\n   - Rename function to `getItemName`\n   - Update JSDoc: 'Get the item name (file or folder) from a path'\n\n2. In `src/main.ts`:\n   - Update import\n   - Usage already correct (`itemName`)\n\n3. In `tests/utils.test.ts`:\n   - Rename test describe block\n   - Update import\n\n## Files\n- src/utils.ts:57-67\n- src/main.ts:9,141\n- tests/utils.test.ts:113-130\n\n## Note\nThis is a low-priority cosmetic change. The function works correctly regardless of name.","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T14:17:04.419994-06:00","created_by":"zain","updated_at":"2026-01-06T14:21:08.626043-06:00","closed_at":"2026-01-06T14:21:08.626043-06:00","close_reason":"Renamed to getItemName"}
{"id":"para_plugin-gjo","title":"Add test for MAX_COLLISION_ATTEMPTS error branch","description":"## Problem\nIn `src/utils.ts:110-112`, the error branch when too many collisions occur is untested:\n\n```typescript\nif (counter \u003e MAX_COLLISION_ATTEMPTS) {\n  throw new Error('Too many archive collisions - please clean up your archive folder');\n}\n```\n\n## Fix\nAdd test in `tests/utils.test.ts` that creates a Set which always returns `has() === true`:\n\n```typescript\nit('throws error when MAX_COLLISION_ATTEMPTS exceeded', () =\u003e {\n  // Create a Set-like object that always reports collision\n  const alwaysCollides = {\n    has: () =\u003e true,\n  } as Set\u003cstring\u003e;\n  \n  expect(() =\u003e \n    generateArchiveDestination('Archive', 'Project', alwaysCollides)\n  ).toThrow('Too many archive collisions');\n});\n```\n\nOr use a real Set with 1001+ entries (slower but more realistic).\n\n## Files\n- tests/utils.test.ts (add new test in generateArchiveDestination describe block)","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-06T13:27:30.306933-06:00","created_by":"zain","updated_at":"2026-01-06T13:33:18.08227-06:00","closed_at":"2026-01-06T13:33:18.08227-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-grk","title":"Update CLAUDE.md project structure diagram","description":"## Problem\nThe project structure diagram in CLAUDE.md doesn't show newer files like AGENTS.md or the .beads/ directory.\n\n## Current Structure (CLAUDE.md lines 17-33)\nMissing:\n- AGENTS.md\n- .beads/ directory\n\n## Fix\nUpdate the structure diagram to reflect current state:\n```\narchive-project/\n├── src/\n│   ├── main.ts           # Plugin entry point\n│   ├── settings.ts       # Settings tab and interface\n│   └── utils.ts          # Pure utility functions (testable)\n├── scripts/\n│   └── install-dev.mjs   # Dev installation script\n├── tests/\n│   └── utils.test.ts     # Unit tests for pure functions\n├── .beads/               # BD task tracking database\n├── manifest.json         # Obsidian plugin manifest\n├── versions.json         # Version compatibility mapping\n├── package.json\n├── tsconfig.json\n├── eslint.config.mjs\n├── esbuild.config.mjs\n├── CLAUDE.md\n├── AGENTS.md\n└── README.md\n```\n\n## Files\n- CLAUDE.md","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:48:18.791732-06:00","created_by":"zain","updated_at":"2026-01-06T13:49:33.291248-06:00","closed_at":"2026-01-06T13:49:33.291248-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-gux","title":"Add explicit Escape key handling in confirmation modal","description":"## Problem\nThe modal handles Enter key explicitly but relies on Obsidian's default Escape handling. Adding explicit handling improves robustness.\n\n## Current Code (src/main.ts:59-66)\n```typescript\nconst handleKeydown = (e: KeyboardEvent) =\u003e {\n  if (e.key === 'Enter' \u0026\u0026 !e.isComposing) {\n    e.preventDefault();\n    this.confirmed = true;\n    this.onConfirm();\n    this.close();\n  }\n};\n```\n\n## Fix\nAdd Escape key handling to the same handler:\n```typescript\nconst handleKeydown = (e: KeyboardEvent) =\u003e {\n  if (e.key === 'Enter' \u0026\u0026 !e.isComposing) {\n    e.preventDefault();\n    this.confirmed = true;\n    this.onConfirm();\n    this.close();\n  } else if (e.key === 'Escape') {\n    e.preventDefault();\n    this.close();\n  }\n};\n```\n\n## Files\n- src/main.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T13:50:12.06252-06:00","created_by":"zain","updated_at":"2026-01-06T13:51:18.022559-06:00","closed_at":"2026-01-06T13:51:18.022559-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-huu","title":"Add afterEach to restore timers in vitest tests","description":"## Problem\nIn `tests/utils.test.ts:133-137`, the `generateArchiveDestination` test suite uses fake timers but never restores them:\n\n```typescript\ndescribe('generateArchiveDestination', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2024-03-15T12:00:00Z'));\n  });\n  // Missing: afterEach(() =\u003e vi.useRealTimers());\n```\n\n## Impact\nFake timers leak into subsequent test files if test order changes or new test files are added. This can cause flaky tests that are hard to debug.\n\n## Fix\nAdd afterEach cleanup:\n\n```typescript\nafterEach(() =\u003e {\n  vi.useRealTimers();\n});\n```\n\nOr use `vi.restoreAllMocks()` if other mocks are added later.\n\n## Files\n- tests/utils.test.ts:133-137","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:11:55.277708-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.330377-06:00","closed_at":"2026-01-06T13:15:31.330377-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-ive","title":"Make onClick handler explicitly async","description":"## Problem\nIn `src/main.ts:40`, the onClick handler returns a Promise but isn't marked async:\n\n```typescript\n.onClick(() =\u003e this.archiveFolder(file));\n```\n\nThis returns a Promise that Obsidian ignores. It works, but the intent is unclear.\n\n## Suggested Fix\nEither make it explicitly async (if we want to await):\n```typescript\n.onClick(async () =\u003e {\n  await this.archiveFolder(file);\n});\n```\n\nOr use void to indicate fire-and-forget:\n```typescript\n.onClick(() =\u003e {\n  void this.archiveFolder(file);\n});\n```\n\nThe first option is preferred as it matches the pattern used elsewhere in the codebase.\n\n## Files\n- src/main.ts:40","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:13:49.170034-06:00","created_by":"zain","updated_at":"2026-01-06T13:16:46.030274-06:00","closed_at":"2026-01-06T13:16:46.030274-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-l5y","title":"Validate that Archive folder differs from Projects folder","description":"## Problem\nUsers can set both `projectsPath` and `archivePath` to the same value (e.g., both 'Projects'). This causes undefined behavior - archiving a project would try to move it into its parent folder, potentially causing conflicts or weird nesting.\n\n## Reproduction\n1. Open plugin settings\n2. Set 'Projects folder' to 'Projects'\n3. Set 'Archive folder' to 'Projects'\n4. Try to archive a project\n5. Behavior is undefined/confusing\n\n## Suggested Fix\nAdd validation in one of these places:\n\n**Option A: Validate on settings save**\n```typescript\n.onChange(async (value) =\u003e {\n  const normalized = value.trim().replace(/\\/+$/, '') || 'Archive';\n  if (normalized === this.plugin.settings.projectsPath) {\n    new Notice('Archive folder cannot be the same as Projects folder');\n    return; // Don't save\n  }\n  this.plugin.settings.archivePath = normalized;\n  await this.plugin.saveSettings();\n})\n```\n\n**Option B: Validate at archive time**\nIn `archiveFolder()`, check before proceeding and show error Notice.\n\nOption A is better UX - prevents invalid state from being saved.\n\n## Files\n- src/settings.ts:48-51\n\n## Acceptance Criteria\n- [ ] Cannot save settings where projectsPath === archivePath\n- [ ] User sees clear error message explaining why\n- [ ] Existing users with invalid config see error on first archive attempt","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T13:13:15.157332-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.332765-06:00","closed_at":"2026-01-06T13:15:31.332765-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-mcf","title":"Support env var for default vault path in install-dev.mjs","description":"## Problem\n`scripts/install-dev.mjs:23` hardcodes a user-specific path:\n\n```typescript\nconst DEFAULT_VAULT = '/Users/zain/test/PluginDev/TEST_Vault';\n```\n\nOther contributors would need to always use `--vault` flag.\n\n## Fix\nRead from environment variable with fallback:\n\n```typescript\nconst DEFAULT_VAULT = process.env.OBSIDIAN_TEST_VAULT || '/Users/zain/test/PluginDev/TEST_Vault';\n```\n\nContributors can then set in their shell profile:\n```bash\nexport OBSIDIAN_TEST_VAULT='/path/to/my/vault'\n```\n\n## Files\n- scripts/install-dev.mjs:23","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:27:50.313167-06:00","created_by":"zain","updated_at":"2026-01-06T13:33:18.072432-06:00","closed_at":"2026-01-06T13:33:18.072432-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-n44","title":"Extract test date constant and add MAX_COLLISION_ATTEMPTS test","description":"## Problem\n1. The test file uses hardcoded date '2024-03-15' in multiple assertion strings\n2. No explicit test verifying MAX_COLLISION_ATTEMPTS constant behavior\n\n## Current Code (tests/utils.test.ts)\n```typescript\nvi.setSystemTime(new Date('2024-03-15T12:00:00Z'));\n// ... later ...\nexpect(result).toBe('Archive/MyProject (Archived 2024-03-15)');\n```\n\n## Fix\n1. Extract date to a constant at the top of the describe block:\n```typescript\ndescribe('generateArchiveDestination', () =\u003e {\n  const TEST_DATE = '2024-03-15';\n  const TEST_DATE_ISO = `${TEST_DATE}T12:00:00Z`;\n\n  beforeEach(() =\u003e {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date(TEST_DATE_ISO));\n  });\n```\n\n2. Update all assertion strings to use the constant via template literals\n\n## Files\n- tests/utils.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T13:48:16.528199-06:00","created_by":"zain","updated_at":"2026-01-06T13:49:33.281378-06:00","closed_at":"2026-01-06T13:49:33.281378-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-n4a","title":"Modal constructor uses 'app: any' instead of typed App","description":"## Problem\nIn `src/main.ts:21`, the ArchiveConfirmModal constructor uses `any` type:\n\n```typescript\nconstructor(app: any, folderName: string, destPath: string, onConfirm: () =\u003e void) {\n```\n\nThis loses TypeScript type safety.\n\n## Fix\nChange to use the `App` type which is already imported at line 1:\n\n```typescript\nconstructor(app: App, folderName: string, destPath: string, onConfirm: () =\u003e void) {\n```\n\n## Files\n- src/main.ts:21","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T13:26:34.57726-06:00","created_by":"zain","updated_at":"2026-01-06T13:34:48.193753-06:00","closed_at":"2026-01-06T13:34:48.193753-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-p98","title":"Document versions.json format in CLAUDE.md","description":"## Problem\nThe `versions.json` file contains:\n```json\n{ \"1.0.0\": \"1.0.0\" }\n```\n\nThis maps plugin version to minimum Obsidian version, but this isn't documented anywhere in the project.\n\n## Context\nThis is standard Obsidian plugin convention:\n- Key: plugin version\n- Value: minimum Obsidian version required for that plugin version\n\nWhen users on older Obsidian versions try to install, Obsidian uses this to warn about compatibility.\n\n## Suggested Fix\nAdd explanation to CLAUDE.md in a 'Plugin Files' section:\n\n```markdown\n## Plugin Files\n\n### versions.json\nMaps plugin versions to minimum required Obsidian versions.\nFormat: `{ \"plugin_version\": \"min_obsidian_version\" }`\nUpdate this when releasing new versions that require newer Obsidian APIs.\n```\n\n## Files\n- CLAUDE.md\n- versions.json (reference only)","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:14:10.119337-06:00","created_by":"zain","updated_at":"2026-01-06T13:15:31.333916-06:00","closed_at":"2026-01-06T13:15:31.333916-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-pp4","title":"Settings text input should revert on validation failure","description":"## Problem\nIn src/settings.ts:37-45 and 55-63, when validation fails (paths match), a Notice shows but the text input retains the invalid value.\n\n## Current Code\n```typescript\n.onChange(async (value) =\u003e {\n  const normalized = value.trim().replace(/\\/+$/, '') || 'Projects';\n  if (normalized === this.plugin.settings.archivePath) {\n    new Notice('Projects folder cannot be the same as Archive folder');\n    return;  // Returns without reverting the text field\n  }\n  ...\n})\n```\n\n## Fix\nStore a reference to the text component and revert on failure:\n```typescript\n.addText((text) =\u003e\n  text\n    .setPlaceholder('Projects')\n    .setValue(this.plugin.settings.projectsPath)\n    .onChange(async (value) =\u003e {\n      const normalized = value.trim().replace(/\\/+$/, '') || 'Projects';\n      if (normalized === this.plugin.settings.archivePath) {\n        new Notice('Projects folder cannot be the same as Archive folder');\n        text.setValue(this.plugin.settings.projectsPath); // Revert\n        return;\n      }\n      ...\n    })\n)\n```\n\nDo the same for the Archive folder input.\n\n## Files\n- src/settings.ts","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:48:15.33429-06:00","created_by":"zain","updated_at":"2026-01-06T13:49:33.272111-06:00","closed_at":"2026-01-06T13:49:33.272111-06:00","close_reason":"Implemented by Haiku sub-agents"}
{"id":"para_plugin-qep","title":"Prevent double-click race condition on archive menu item","description":"## Problem\nIf a user right-clicks and clicks 'Archive it' multiple times quickly before the first operation completes, multiple archive attempts occur. The second attempt fails because the item has already been moved, showing an error notice.\n\n## Current Behavior\n- First click: Archives successfully\n- Second click: Fails with error 'Failed to archive: ...' (item not found)\n- No data loss, but confusing UX\n\n## Suggested Fix\nTrack in-progress archive operations and prevent concurrent archives of the same item.\n\n**Option A: Track in-progress items**\n```typescript\nprivate archivingItems = new Set\u003cstring\u003e();\n\nasync archiveItem(item: TAbstractFile): Promise\u003cvoid\u003e {\n  if (this.archivingItems.has(item.path)) {\n    return; // Already archiving this item\n  }\n  this.archivingItems.add(item.path);\n  try {\n    // ... existing archive logic\n  } finally {\n    this.archivingItems.delete(item.path);\n  }\n}\n```\n\n**Option B: Disable during operation**\nMore complex - would need to track menu item state.\n\nOption A is simpler and sufficient.\n\n## Files\n- src/main.ts:138-179 (archiveItem method)\n\n## Acceptance Criteria\n- [ ] Rapid double-clicks only archive once\n- [ ] No error shown for prevented duplicate attempts\n- [ ] Normal single-click behavior unchanged","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T14:16:40.766329-06:00","created_by":"zain","updated_at":"2026-01-06T14:20:12.002464-06:00","closed_at":"2026-01-06T14:20:12.002464-06:00","close_reason":"Double-click prevention implemented"}
{"id":"para_plugin-rcp","title":"Modal promise never resolves if user cancels/escapes","description":"## Problem\nIn `src/main.ts:121-126`, when confirmation modal is enabled, the Promise only resolves if user clicks 'Archive':\n\n```typescript\nif (this.settings.confirmBeforeArchive) {\n  return new Promise\u003cvoid\u003e((resolve) =\u003e {\n    new ArchiveConfirmModal(this.app, folderName, destPath, async () =\u003e {\n      await this.performArchive(folder, destPath, folderName, archivePath);\n      resolve();\n    }).open();\n  });\n}\n```\n\nIf user:\n- Presses Escape\n- Clicks outside modal\n- Clicks Cancel button\n\nThe Promise never resolves. The `archiveFolder` function hangs indefinitely (doesn't block UI since async, but semantically wrong).\n\n## Fix\nAdd onCancel callback or resolve in onClose:\n\n**Option A: Add onCancel parameter**\n```typescript\nclass ArchiveConfirmModal extends Modal {\n  private onCancel: () =\u003e void;\n  \n  constructor(app: App, folderName: string, destPath: string, onConfirm: () =\u003e void, onCancel: () =\u003e void) {\n    // ...\n    this.onCancel = onCancel;\n  }\n  \n  onClose() {\n    this.onCancel(); // Always call on close\n    this.contentEl.empty();\n  }\n}\n```\n\n**Option B: Track if confirmed**\n```typescript\nprivate confirmed = false;\n\n// In confirm handler:\nthis.confirmed = true;\nthis.onConfirm();\nthis.close();\n\n// In onClose:\nif (!this.confirmed) {\n  // User cancelled\n}\n```\n\n## Files\n- src/main.ts:16-50 (ArchiveConfirmModal class)\n- src/main.ts:121-126 (Promise creation)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T13:26:26.963516-06:00","created_by":"zain","updated_at":"2026-01-06T13:34:12.353653-06:00","closed_at":"2026-01-06T13:34:12.353653-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-rdh","title":"Add 'Archive Project' command to command palette","description":"## Feature\nAdd a command palette command 'Archive Project' that archives the project/area/resource folder containing the currently active file.\n\n## Behavior\n- **Visible/enabled when**: Active file is inside a top-level item (direct child of any PARA source folder)\n- **Action**: Archives the entire containing folder (same as right-click 'Archive it')\n- **If not in a source folder**: Command not available\n\n## PARA Context\nCurrently the plugin only supports `projectsPath` as a source folder. Soon we'll add:\n- `areasPath` (default: 'Areas')\n- `resourcesPath` (default: 'Resources')\n\nThe implementation should be generic enough to find the top-level parent under ANY configured source folder.\n\n## Implementation\n\nIn `src/main.ts` `onload()`, add a command:\n\n```typescript\nthis.addCommand({\n  id: 'archive-project',\n  name: 'Archive Project',\n  checkCallback: (checking: boolean) =\u003e {\n    const activeFile = this.app.workspace.getActiveFile();\n    if (\\!activeFile) return false;\n    \n    const topLevelFolder = this.findTopLevelParent(activeFile);\n    if (\\!topLevelFolder) return false;\n    \n    if (\\!checking) {\n      this.archiveItem(topLevelFolder);\n    }\n    return true;\n  },\n});\n```\n\n## Helper method to add\n\n```typescript\n/**\n * Find the top-level PARA folder containing the given file.\n * Walks up the directory tree to find a direct child of any source folder.\n * Returns null if file is not inside a PARA source folder.\n */\nprivate findTopLevelParent(file: TAbstractFile): TFolder | null {\n  const sourceFolders = this.getSourceFolders();\n  \n  let current = file instanceof TFile ? file.parent : file;\n  while (current) {\n    if (sourceFolders.some(src =\u003e isTopLevelProjectFolder(current\\!.path, src))) {\n      return current;\n    }\n    current = current.parent;\n  }\n  return null;\n}\n\n/**\n * Get all configured PARA source folders that can be archived from.\n * Currently just projectsPath, but will expand to areas/resources.\n */\nprivate getSourceFolders(): string[] {\n  return [\n    normalizePath(this.settings.projectsPath),\n    // Future: add when settings exist\n    // normalizePath(this.settings.areasPath),\n    // normalizePath(this.settings.resourcesPath),\n  ];\n}\n```\n\n## Note\nThe `getSourceFolders()` helper is shared with the 'Archive File' command (para_plugin-vx8). Implement once, use in both.\n\n## Future expansion\nWhen adding areas/resources support:\n1. Add paths to `getSourceFolders()`\n2. Commands automatically work for all PARA types\n3. Consider renaming command to 'Archive Item' if it feels more generic\n\n## Files\n- src/main.ts (onload method, helper methods)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T13:39:18.851666-06:00","created_by":"zain","updated_at":"2026-01-06T13:41:06.83412-06:00"}
{"id":"para_plugin-uvy","title":"Extract magic number MAX_COLLISION_ATTEMPTS to named constant","description":"## Problem\nIn `src/utils.ts:100`, there's a magic number:\n\n```typescript\nif (counter \u003e 1000) {\n  throw new Error('Too many archive collisions...');\n}\n```\n\nAnd in `src/main.ts:79`:\n```typescript\nconst maxRetries = 3;\n```\n\n## Suggested Fix\nExtract to named constants at the top of each file:\n\n```typescript\n// utils.ts\nconst MAX_COLLISION_ATTEMPTS = 1000;\n\n// main.ts  \nconst MAX_RENAME_RETRIES = 3;\n```\n\nThis makes the code more self-documenting and easier to adjust if needed.\n\n## Files\n- src/utils.ts:100\n- src/main.ts:79","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T13:13:57.497073-06:00","created_by":"zain","updated_at":"2026-01-06T13:17:31.060544-06:00","closed_at":"2026-01-06T13:17:31.060544-06:00","close_reason":"Implemented by Haiku sub-agent"}
{"id":"para_plugin-v4b","title":"Expand test coverage for error paths and edge cases","description":"## Current State\nThe plugin has 27 unit tests covering all pure utility functions in `src/utils.ts`:\n- normalizePathPure (7 tests)\n- getParentPath (4 tests)\n- isTopLevelProjectFolder (6 tests)\n- getFolderName (4 tests)\n- generateArchiveDestination (6 tests)\n\n## Gaps\nThe following are NOT unit-tested (they involve Obsidian API and would need mocking):\n\n1. **ensureFolderExists behavior**\n   - When folder exists\n   - When folder doesn't exist (creates it)\n   - When file exists at path (should error - see para_plugin-8vt)\n\n2. **archiveFolder error paths**\n   - Archive folder creation fails\n   - Rename fails after max retries\n   - Settings have invalid paths\n\n3. **Settings persistence**\n   - Settings load correctly on plugin start\n   - Settings save correctly on change\n   - Default values applied for missing settings\n\n4. **getExistingArchivePaths**\n   - Returns correct Set of child paths\n   - Handles empty archive folder\n   - Handles non-existent archive folder\n\n## Suggested Approach\nFor Obsidian API testing, consider:\n1. Creating mock objects for `app.vault`, `app.workspace`\n2. Using dependency injection to allow test doubles\n3. Or accepting that integration testing happens manually in Obsidian\n\n## Files\n- tests/utils.test.ts (existing)\n- tests/main.test.ts (to create)\n- tests/mocks/obsidian.ts (to create if mocking)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T13:13:28.934879-06:00","created_by":"zain","updated_at":"2026-01-06T13:13:28.934879-06:00"}
{"id":"para_plugin-vx8","title":"Add 'Archive File' command to command palette","description":"## Feature\nAdd a command palette command 'Archive File' that archives only the currently active file.\n\n## Behavior\n- **Visible/enabled when**: There is an active file AND it's a direct child of a PARA source folder\n- **Action**: Archives just that file to archivePath\n- **If no active file or not in a source folder**: Command not available\n\n## PARA Context\nCurrently the plugin only supports `projectsPath` as a source folder. Soon we'll add:\n- `areasPath` (default: 'Areas')\n- `resourcesPath` (default: 'Resources')\n\nThe implementation should be generic enough to check if the active file is a direct child of ANY configured source folder.\n\n## Implementation\n\nIn `src/main.ts` `onload()`, add a command:\n\n```typescript\nthis.addCommand({\n  id: 'archive-file',\n  name: 'Archive File',\n  checkCallback: (checking: boolean) =\u003e {\n    const activeFile = this.app.workspace.getActiveFile();\n    if (!activeFile) return false;\n    \n    // Check if active file is direct child of any PARA source folder\n    const sourceFolders = this.getSourceFolders(); // Returns array of normalized paths\n    const isInSourceFolder = sourceFolders.some(sourcePath =\u003e \n      isTopLevelProjectFolder(activeFile.path, sourcePath)\n    );\n    \n    if (!isInSourceFolder) {\n      return false;\n    }\n    \n    if (!checking) {\n      this.archiveItem(activeFile);\n    }\n    return true;\n  },\n});\n```\n\n## Helper method to add\n\n```typescript\n/**\n * Get all configured PARA source folders that can be archived from.\n * Currently just projectsPath, but will expand to areas/resources.\n */\nprivate getSourceFolders(): string[] {\n  return [\n    normalizePath(this.settings.projectsPath),\n    // Future: add when settings exist\n    // normalizePath(this.settings.areasPath),\n    // normalizePath(this.settings.resourcesPath),\n  ];\n}\n```\n\n## Future expansion\nWhen adding areas/resources support:\n1. Add `areasPath` and `resourcesPath` to settings interface\n2. Add them to `getSourceFolders()` return array\n3. Update context menu registration to also show on direct children of areas/resources\n4. Commands will automatically work due to generic implementation\n\n## Files\n- src/main.ts (onload method, new helper method)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T13:39:30.351214-06:00","created_by":"zain","updated_at":"2026-01-06T13:40:52.133851-06:00"}
