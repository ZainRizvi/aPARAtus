"use strict";var d=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var S=(i,e)=>{for(var t in e)d(i,t,{get:e[t],enumerable:!0})},y=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of F(e))!w.call(i,s)&&s!==t&&d(i,s,{get:()=>e[s],enumerable:!(r=j(e,s))||r.enumerable});return i};var x=i=>y(d({},"__esModule",{value:!0}),i);var E={};S(E,{default:()=>p});module.exports=x(E);var n=require("obsidian");var c=require("obsidian"),v={projectsPath:"Projects",archivePath:"Archive",focusAfterArchive:!0},l=class extends c.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new c.Setting(e).setName("Projects folder").setDesc("Path to your Projects folder (top-level project folders live here)").addText(t=>t.setPlaceholder("Projects").setValue(this.plugin.settings.projectsPath).onChange(async r=>{this.plugin.settings.projectsPath=r.trim()||"Projects",await this.plugin.saveSettings()})),new c.Setting(e).setName("Archive folder").setDesc("Path where archived projects will be moved").addText(t=>t.setPlaceholder("Archive").setValue(this.plugin.settings.archivePath).onChange(async r=>{this.plugin.settings.archivePath=r.trim()||"Archive",await this.plugin.saveSettings()})),new c.Setting(e).setName("Focus Projects folder after archive").setDesc("Return focus to the Projects folder in the file explorer after archiving").addToggle(t=>t.setValue(this.plugin.settings.focusAfterArchive).onChange(async r=>{this.plugin.settings.focusAfterArchive=r,await this.plugin.saveSettings()}))}};function h(i){return i.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/^\/+/,"").replace(/\/+$/,"")}function T(i){let e=h(i),t=e.lastIndexOf("/");return t===-1?"":e.substring(0,t)}function P(i,e){let t=h(i),r=h(e);return T(t)===r}function m(i){let e=h(i),t=e.lastIndexOf("/");return t===-1?e:e.substring(t+1)}function A(i,e,t){let r=h(i),s=`${r}/${e}`;if(!t.has(s))return s;let a=new Date().toISOString().split("T")[0],u=`${r}/${e} (Archived ${a})`;if(!t.has(u))return u;let g=2;for(;;){let f=`${r}/${e} (Archived ${a}) (${g})`;if(!t.has(f))return f;if(g++,g>1e3)throw new Error("Too many archive collisions - please clean up your archive folder")}}var p=class extends n.Plugin{constructor(){super(...arguments);this.settings=v}async onload(){await this.loadSettings(),this.addSettingTab(new l(this.app,this)),this.registerEvent(this.app.workspace.on("file-menu",(t,r)=>{if(!(r instanceof n.TFolder))return;let s=(0,n.normalizePath)(this.settings.projectsPath);P(r.path,s)&&t.addItem(o=>{o.setTitle("Archive it").setIcon("archive").onClick(()=>this.archiveFolder(r))})}))}async loadSettings(){this.settings=Object.assign({},v,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async archiveFolder(t){let r=(0,n.normalizePath)(this.settings.archivePath),s=m(t.path);try{await this.ensureFolderExists(r);let o=this.getExistingArchivePaths(r),a=A(r,s,o);await this.app.vault.rename(t,a),new n.Notice(`Archived "${s}" to ${a}`),this.settings.focusAfterArchive&&await this.focusProjectsFolder()}catch(o){let a=o instanceof Error?o.message:"Unknown error";new n.Notice(`Failed to archive "${s}": ${a}`),console.error("Archive Project: Failed to archive folder",o)}}async ensureFolderExists(t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t)}getExistingArchivePaths(t){let r=new Set,s=this.app.vault.getAbstractFileByPath(t);if(s instanceof n.TFolder)for(let o of s.children)r.add((0,n.normalizePath)(o.path));return r}async focusProjectsFolder(){let t=(0,n.normalizePath)(this.settings.projectsPath),r=this.app.vault.getAbstractFileByPath(t);if(r)try{let s=this.app.workspace.getLeavesOfType("file-explorer")[0];if(!s)return;let o=s.view;typeof o.revealInFolder=="function"&&o.revealInFolder(r)}catch{}}};
