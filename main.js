"use strict";var $=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var nt=(i,s)=>{for(var t in s)$(i,t,{get:s[t],enumerable:!0})},it=(i,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of rt(s))!at.call(i,r)&&r!==t&&$(i,r,{get:()=>s[r],enumerable:!(e=st(s,r))||e.enumerable});return i};var ot=i=>it($({},"__esModule",{value:!0}),i);var pt={};nt(pt,{default:()=>D});module.exports=ot(pt);var u=require("obsidian");function Y(i,s){let t=Object.keys(s).map(e=>lt(i,e,s[e]));return t.length===1?t[0]:function(){t.forEach(e=>e())}}function lt(i,s,t){let e=i[s],r=i.hasOwnProperty(s),n=r?e:function(){return Object.getPrototypeOf(i)[s].apply(this,arguments)},a=t(n);return e&&Object.setPrototypeOf(a,e),Object.setPrototypeOf(l,a),i[s]=l,o;function l(...c){return a===n&&i[s]===l&&o(),a.apply(this,c)}function o(){i[s]===l&&(r?i[s]=n:delete i[s]),a!==n&&(a=n,Object.setPrototypeOf(l,e||Function))}}var h=require("obsidian");function G(i,s){let t=y(i),e=y(s);return!!(t===e||e.startsWith(t+"/")||t.startsWith(e+"/"))}function W(i){for(let s=0;s<i.length;s++)for(let t=s+1;t<i.length;t++)if(G(i[s],i[t])){let e=y(i[s]),r=y(i[t]);return`PARA folders cannot be nested: "${e}" and "${r}"`}return null}function y(i){return i.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/^\/+/,"").replace(/\/+$/,"")}function ct(i){let s=y(i),t=s.lastIndexOf("/");return t===-1?"":s.substring(0,t)}function b(i,s){let t=y(i),e=y(s);return ct(t)===e}function R(i){let s=y(i),t=s.lastIndexOf("/");return t===-1?s:s.substring(t+1)}function k(i,s,t){let e=y(i),r=`${e}/${s}`;if(!t.has(r))return r;let a=new Date().toISOString().split("T")[0],l=`${e}/${s} (Archived ${a})`;if(!t.has(l))return l;let o=2;for(;;){let c=`${e}/${s} (Archived ${a}) (${o})`;if(!t.has(c))return c;if(o++,o>1e3)throw new Error("Too many archive collisions - please clean up your archive folder")}}var H={projectsPath:"Projects",areasPath:"Areas",resourcesPath:"Resources",archivePath:"Archive"};function q(i,s,t){let r=["projectsPath","areasPath","resourcesPath","archivePath"].filter(n=>n!==s);for(let n of r){let a=t[n],l=H[n],o=H[s];if(i===a)return`${o} folder cannot be the same as ${l} folder`;if(G(i,a))return`${o} folder cannot be nested with ${l} folder`}return null}function J(i){let s=i.indexOf("{{name}}");return s===-1?i:i.substring(0,s)}function X(i,s){return s.mtime-i.mtime}async function O(i,s){let t=(0,h.normalizePath)(s);i.vault.getAbstractFileByPath(t)||await i.vault.createFolder(t)}function M(i){return{Project:`# {{name}}

A project is a series of tasks linked to a goal, with a deadline.

## Status
- [ ] In Progress

## Goals
-

## Tasks
-

## Notes
- `,Area:`# {{name}}

An area is a sphere of activity with a standard to maintain over time.

## Responsibilities
-

## Standards
-

## Notes
- `,Resource:`# {{name}}

A resource is a topic or tool you want to reference in the future.

## Overview
-

## Key Points
-

## Related Resources
- `}[i]||`# {{name}}
`}var V=class extends h.AbstractInputSuggest{constructor(s,t){super(s,t)}getSuggestions(s){let t=this.app.vault.getAllLoadedFiles().filter(r=>r instanceof h.TFolder);if(!s)return t;let e=s.toLowerCase();return t.filter(r=>r.path.toLowerCase().includes(e))}renderSuggestion(s,t){t.setText(s.path)}selectSuggestion(s){this.setValue(s.path),this.close()}},v={projectsPath:"Projects",areasPath:"Areas",resourcesPath:"Resources",archivePath:"Archive",focusAfterArchive:!0,confirmBeforeArchive:!1,projectFolderFormat:"YYYY-MM-DD {{name}}",projectTemplatePath:"",areaTemplatePath:"",resourceTemplatePath:"",projectSortOrder:"disabled"},K={projectsPath:"Projects",areasPath:"Areas",resourcesPath:"Resources",archivePath:"Archive"},E="aparatus-invalid-input",B="aparatus-warning-input";function N(i,s,t,e){let r=s.inputEl;class n extends h.AbstractInputSuggest{constructor(c,g){super(c,g)}getSuggestions(c){let g=t.app.vault.getAllLoadedFiles().filter(w=>typeof w.name=="string"&&w.name.endsWith(".md"));if(!c)return g.slice(0,50);let f=c.toLowerCase();return g.filter(w=>w.path.toLowerCase().includes(f)).slice(0,20)}renderSuggestion(c,g){g.setText(c.path)}selectSuggestion(c){this.setValue(c.path),this.close()}}new n(t.app,r);let a=document.createElement("div");a.classList.add("aparatus-inline-message"),a.style.display="none",a.style.color="var(--text-muted)",i.settingEl.insertAdjacentElement("afterend",a);let l=o=>{if(!o.trim()){a.style.display="none";return}t.app.vault.getAbstractFileByPath(o)?a.style.display="none":(a.textContent=`Template file "${o}" does not exist (will use default template)`,a.style.display="block")};r.addEventListener("blur",async()=>{let o=s.getValue().trim();l(o),await e(o)}),setTimeout(()=>l(s.getValue()),0)}function j(i,s,t,e){let r=s.inputEl;new V(e.app,r);let n=document.createElement("div");n.classList.add("aparatus-inline-message"),n.style.display="none",i.settingEl.insertAdjacentElement("afterend",n);let a=l=>{e.app.vault.getAbstractFileByPath(l)?(r.classList.remove(B),n.style.display="none"):(r.classList.add(B),n.textContent=`Folder "${l}" does not exist (will be created automatically)`,n.style.display="block")};s.setPlaceholder(K[t]).setValue(e.settings[t]),setTimeout(()=>a(e.settings[t]),0),r.addEventListener("blur",async()=>{let o=s.getValue().trim().replace(/\/+$/,"")||K[t],c=q(o,t,e.settings);c?(r.classList.add(E),r.classList.remove(B),n.textContent=c,n.style.color="var(--text-error)",n.style.display="block",s.setValue(e.settings[t]),setTimeout(()=>{r.classList.remove(E),n.style.color="var(--color-yellow)",a(e.settings[t])},100)):(r.classList.remove(E),a(o),e.settings[t]=o,await e.saveSettings())})}var C=class extends h.PluginSettingTab{constructor(s,t){super(s,t),this.plugin=t}display(){let{containerEl:s}=this;s.empty();let t=new h.Setting(s).setName("Projects folder").setDesc("Path to your Projects folder (top-level project folders live here)");t.addText(p=>j(t,p,"projectsPath",this.plugin));let e=new h.Setting(s).setName("Areas folder").setDesc("Path to your Areas folder (top-level area folders live here)");e.addText(p=>j(e,p,"areasPath",this.plugin));let r=new h.Setting(s).setName("Resources folder").setDesc("Path to your Resources folder (top-level resource folders live here)");r.addText(p=>j(r,p,"resourcesPath",this.plugin));let n=new h.Setting(s).setName("Archive folder").setDesc("Path where archived items will be moved");n.addText(p=>j(n,p,"archivePath",this.plugin));let a=new h.Setting(s).setName("Project folder format"),l=document.createDocumentFragment();l.appendText("Use {{name}} for project name. Supports ");let o=document.createElement("a");o.href="https://momentjs.com/docs/#/displaying/format/",o.textContent="Moment.js tokens",o.setAttr("target","_blank"),l.appendChild(o),l.appendText(": YYYY, MM, DD, etc."),a.setDesc(l);let c=document.createElement("div");c.classList.add("aparatus-inline-message"),c.style.color="var(--text-muted)",a.addText(p=>{let m=p.inputEl,P=d=>{let x=d.includes("{{name}}");if(x){let A="My Project",T=window.moment(),tt=d.replace(/\{\{name\}\}/g,`[${A}]`),et=T.format(tt);c.textContent=`Preview: ${et}`,c.style.color="var(--text-muted)",m.style.borderColor="",m.classList.remove(E)}else c.textContent="Format must contain {{name}}",c.style.color="var(--text-error)",m.classList.add(E);return x};p.setPlaceholder("YYYY-MM-DD {{name}}").setValue(this.plugin.settings.projectFolderFormat),P(this.plugin.settings.projectFolderFormat),m.addEventListener("input",()=>{let d=p.getValue().trim()||v.projectFolderFormat;P(d)}),m.addEventListener("blur",async()=>{let d=p.getValue().trim()||v.projectFolderFormat;P(d)?(this.plugin.settings.projectFolderFormat=d,await this.plugin.saveSettings()):(p.setValue(this.plugin.settings.projectFolderFormat),P(this.plugin.settings.projectFolderFormat))})}),a.settingEl.insertAdjacentElement("afterend",c),new h.Setting(s).setName("Focus source folder after archive").setDesc("Return focus to the source folder (Projects, Areas, or Resources) after archiving").addToggle(p=>p.setValue(this.plugin.settings.focusAfterArchive).onChange(async m=>{this.plugin.settings.focusAfterArchive=m,await this.plugin.saveSettings()})),new h.Setting(s).setName("Confirm before archiving").setDesc("Show a confirmation dialog before archiving a project").addToggle(p=>p.setValue(this.plugin.settings.confirmBeforeArchive).onChange(async m=>{this.plugin.settings.confirmBeforeArchive=m,await this.plugin.saveSettings()})),new h.Setting(s).setName("Project folder sort order").setDesc("How to sort projects in the Projects folder").addDropdown(p=>p.addOption("disabled","Disabled (manual order)").addOption("lastModified","Last modified (newest first)").addOption("datePrefix","Date prefix (newer first)").setValue(this.plugin.settings.projectSortOrder).onChange(async m=>{this.plugin.settings.projectSortOrder=m,await this.plugin.saveSettings(),this.plugin.installSortingPatch();let P=this.plugin.app.workspace.getLeavesOfType("file-explorer")[0];P&&P.view.requestSort?.()})),s.createEl("h3",{text:"Templates"});let g=new h.Setting(s).setName("Project template").setDesc("Template file to apply when creating new projects (optional)");g.addText(p=>{N(g,p,this.plugin,async m=>{this.plugin.settings.projectTemplatePath=m,await this.plugin.saveSettings()}),p.setValue(this.plugin.settings.projectTemplatePath)}),g.addButton(p=>p.setButtonText("Generate Default").onClick(async()=>{let m=M("Project"),P="Templates";await O(this.plugin.app,P);let d=`${P}/Project.md`;if(this.plugin.app.vault.getAbstractFileByPath(d)){new h.Notice("Template already exists at "+d);return}try{await this.plugin.app.vault.create(d,m),this.plugin.settings.projectTemplatePath=d,await this.plugin.saveSettings(),this.display(),new h.Notice("Created project template at "+d)}catch(A){let T=A instanceof Error?A.message:"Unknown error";new h.Notice("Failed to create template: "+T)}}));let f=new h.Setting(s).setName("Area template").setDesc("Template file to apply when creating new areas (optional)");f.addText(p=>{N(f,p,this.plugin,async m=>{this.plugin.settings.areaTemplatePath=m,await this.plugin.saveSettings()}),p.setValue(this.plugin.settings.areaTemplatePath)}),f.addButton(p=>p.setButtonText("Generate Default").onClick(async()=>{let m=M("Area"),P="Templates";await O(this.plugin.app,P);let d=`${P}/Area.md`;if(this.plugin.app.vault.getAbstractFileByPath(d)){new h.Notice("Template already exists at "+d);return}try{await this.plugin.app.vault.create(d,m),this.plugin.settings.areaTemplatePath=d,await this.plugin.saveSettings(),this.display(),new h.Notice("Created area template at "+d)}catch(A){let T=A instanceof Error?A.message:"Unknown error";new h.Notice("Failed to create template: "+T)}}));let w=new h.Setting(s).setName("Resource template").setDesc("Template file to apply when creating new resources (optional)");w.addText(p=>{N(w,p,this.plugin,async m=>{this.plugin.settings.resourceTemplatePath=m,await this.plugin.saveSettings()}),p.setValue(this.plugin.settings.resourceTemplatePath)}),w.addButton(p=>p.setButtonText("Generate Default").onClick(async()=>{let m=M("Resource"),P="Templates";await O(this.plugin.app,P);let d=`${P}/Resource.md`;if(this.plugin.app.vault.getAbstractFileByPath(d)){new h.Notice("Template already exists at "+d);return}try{await this.plugin.app.vault.create(d,m),this.plugin.settings.resourceTemplatePath=d,await this.plugin.saveSettings(),this.display(),new h.Notice("Created resource template at "+d)}catch(A){let T=A instanceof Error?A.message:"Unknown error";new h.Notice("Failed to create template: "+T)}}))}};var _=require("obsidian"),L=class extends _.Modal{constructor(t,e,r,n,a){super(t);this.confirmed=!1;this.itemName=e,this.destPath=r,this.onConfirm=n,this.onCancel=a}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"Archive Item?"}),t.createEl("p",{text:`Move "${this.itemName}" to:`}),t.createEl("p",{text:this.destPath});let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close());let n=e.createEl("button",{text:"Archive",cls:"mod-cta"});n.addEventListener("click",()=>{this.confirmed=!0,this.onConfirm(),this.close()}),n.focus(),this.keydownHandler=a=>{a.key==="Enter"&&!a.isComposing?(a.preventDefault(),this.confirmed=!0,this.onConfirm(),this.close()):a.key==="Escape"&&(a.preventDefault(),this.close())},t.addEventListener("keydown",this.keydownHandler)}onClose(){let{contentEl:t}=this;this.keydownHandler&&t.removeEventListener("keydown",this.keydownHandler),t.empty(),this.confirmed||this.onCancel()}},S=class extends _.Modal{constructor(s,t,e,r){super(s),this.title=t,this.placeholder=e,this.onSubmit=r}onOpen(){let{contentEl:s}=this;s.createEl("h2",{text:this.title});let t=s.createEl("input",{type:"text",placeholder:this.placeholder});t.style.width="100%",t.style.marginBottom="1em",t.focus();let e=s.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>{let a=t.value.trim();a&&(this.onSubmit(a),this.close())}),t.addEventListener("keydown",a=>{if(a.key==="Enter"&&!a.isComposing){a.preventDefault();let l=t.value.trim();l&&(this.onSubmit(l),this.close())}else a.key==="Escape"&&(a.preventDefault(),this.close())})}onClose(){let{contentEl:s}=this;s.empty()}};var F=require("obsidian");async function I(i,s){let t=(0,F.normalizePath)(s),e=i.vault.getAbstractFileByPath(t);if(e){if(!(e instanceof F.TFolder))throw new Error(`"${t}" exists but is not a folder`);return}let r=t.split("/").filter(Boolean);for(let n=1;n<=r.length;n++){let a=r.slice(0,n).join("/"),l=i.vault.getAbstractFileByPath(a);if(!l)await i.vault.createFolder(a);else if(!(l instanceof F.TFolder))throw new Error(`Cannot create folder "${t}": intermediate path "${a}" exists but is not a folder`)}}function z(i,s){let t=new Set,e=i.vault.getAbstractFileByPath(s);if(e instanceof F.TFolder)for(let r of e.children)t.add((0,F.normalizePath)(r.path));return t}async function Q(i,s){let t=(0,F.normalizePath)(s),e=i.vault.getAbstractFileByPath(t);if(e)try{let r=i.workspace.getLeavesOfType("file-explorer")[0];if(!r)return;let n=r.view;typeof n.revealInFolder=="function"&&n.revealInFolder(e)}catch(r){console.debug("aPARAtus: Could not focus folder",r)}}function U(i){let s=0,t=e=>{for(let r of e.children)if(r instanceof F.TFolder)t(r);else{let n=r;typeof n.stat?.mtime=="number"&&(s=Math.max(s,n.stat.mtime))}};return t(i),s}var Z=3,D=class extends u.Plugin{constructor(){super(...arguments);this.settings=v;this.archivingItems=new Set;this.sortingPatchUninstaller=null}async onload(){await this.loadSettings(),this.app.workspace.onLayoutReady(()=>{this.installSortingPatch()}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.installSortingPatch()})),this.addSettingTab(new C(this.app,this)),this.addCommand({id:"archive-item",name:"Archive Item",checkCallback:t=>{let e=this.app.workspace.getActiveFile();if(!e)return!1;let r=this.findTopLevelItem(e);return r?(t||this.archiveItem(r),!0):!1}}),this.addCommand({id:"create-project",name:"Create Project",callback:()=>{new S(this.app,"Create Project","Project name",t=>this.createParaItem(t,"projectsPath","Project")).open()}}),this.addCommand({id:"create-area",name:"Create Area",callback:()=>{new S(this.app,"Create Area","Area name",t=>this.createParaItem(t,"areasPath","Area")).open()}}),this.addCommand({id:"create-resource",name:"Create Resource",callback:()=>{new S(this.app,"Create Resource","Resource name",t=>this.createParaItem(t,"resourcesPath","Resource")).open()}}),this.registerEvent(this.app.workspace.on("file-menu",(t,e)=>{!(e instanceof u.TFolder)&&!(e instanceof u.TFile)||!this.getSourceFolders().some(a=>b(e.path,a))||t.addItem(a=>{a.setTitle("Archive it").setIcon("archive").onClick(async()=>{await this.archiveItem(e)})})}))}onunload(){this.sortingPatchUninstaller?.(),this.archivingItems.clear()}async loadSettings(){this.settings=Object.assign({},v,await this.loadData());let t=this.getSourceFolders(),e=(0,u.normalizePath)(this.settings.archivePath);if(t.includes(e)){new u.Notice("aPARAtus: Invalid settings detected (archive matches source folder), resetting to defaults"),this.settings.projectsPath=v.projectsPath,this.settings.areasPath=v.areasPath,this.settings.resourcesPath=v.resourcesPath,this.settings.archivePath=v.archivePath,await this.saveSettings();return}if(new Set(t).size!==t.length){new u.Notice("aPARAtus: Invalid settings detected (source folders match), resetting to defaults"),this.settings.projectsPath=v.projectsPath,this.settings.areasPath=v.areasPath,this.settings.resourcesPath=v.resourcesPath,await this.saveSettings();return}let n=[this.settings.projectsPath,this.settings.areasPath,this.settings.resourcesPath,this.settings.archivePath],a=W(n);a&&(new u.Notice(`aPARAtus: Invalid settings detected (${a}), resetting to defaults`),this.settings.projectsPath=v.projectsPath,this.settings.areasPath=v.areasPath,this.settings.resourcesPath=v.resourcesPath,this.settings.archivePath=v.archivePath,await this.saveSettings())}async saveSettings(){await this.saveData(this.settings)}isTemplaterAvailable(){try{return!!this.app.plugins?.plugins?.["templater-obsidian"]}catch{return!1}}isCoreTemplatesAvailable(){try{return!!this.app.internalPlugins?.plugins?.templates}catch{return!1}}async applyTemplate(t,e,r){if(!e.trim())return`# ${r}
`;let n=this.app.vault.getAbstractFileByPath(e);if(!(n instanceof u.TFile))return console.warn(`aPARAtus: Template file not found at ${e}, using default`),`# ${r}
`;try{if(this.isTemplaterAvailable()){let o=this.app.plugins?.plugins?.["templater-obsidian"]?.templater;if(o)return await o.parse_template({template_file:n,target_file:t})}return this.isCoreTemplatesAvailable()?(await this.app.vault.read(n)).replace(/{{name}}/g,r):(await this.app.vault.read(n)).replace(/{{name}}/g,r)}catch(a){let l=a instanceof Error?a.message:"Unknown error";return console.warn(`aPARAtus: Failed to apply template: ${l}, using default`),`# ${r}
`}}formatProjectName(t,e){let r=window.moment(),n=e.replace(/\{\{name\}\}/g,`[${t}]`);return r.format(n)}async createParaItem(t,e,r){let n=this.settings[e],a=t;e==="projectsPath"&&(a=this.formatProjectName(t,this.settings.projectFolderFormat));let l=(0,u.normalizePath)(`${n}/${a}`);if(this.app.vault.getAbstractFileByPath(l)){new u.Notice(`${r} "${t}" already exists`);return}try{await I(this.app,n),await this.app.vault.createFolder(l);let o=(0,u.normalizePath)(`${l}/index.md`),c="";e==="projectsPath"?c=this.settings.projectTemplatePath:e==="areasPath"?c=this.settings.areaTemplatePath:e==="resourcesPath"&&(c=this.settings.resourceTemplatePath);let g=await this.app.vault.create(o,""),f=await this.applyTemplate(g,c,t);f&&await this.app.vault.modify(g,f),await this.app.workspace.getLeaf().openFile(g),new u.Notice(`Created ${r.toLowerCase()} "${t}"`)}catch(o){let c=o instanceof Error?o.message:"Unknown error";new u.Notice(`Failed to create ${r.toLowerCase()}: ${c}`),console.error(`aPARAtus: Failed to create ${r}`,o)}}getSourceFolders(){return[(0,u.normalizePath)(this.settings.projectsPath),(0,u.normalizePath)(this.settings.areasPath),(0,u.normalizePath)(this.settings.resourcesPath)]}findTopLevelItem(t){let e=this.getSourceFolders();if(e.some(n=>b(t.path,n)))return t;let r=t.parent;for(;r;){if(e.some(n=>b(r.path,n)))return r;r=r.parent}return null}installSortingPatch(){if(this.sortingPatchUninstaller?.(),this.sortingPatchUninstaller=null,this.settings.projectSortOrder==="disabled")return;let t=this.app.workspace.getLeavesOfType("file-explorer")[0];if(!t){console.warn("aPARAtus: File explorer not found, cannot install sorting patch");return}let e=t.view;if(typeof e.getSortedFolderItems!="function"){console.warn("aPARAtus: getSortedFolderItems not found on file explorer view");return}if(typeof e.requestSort!="function"){console.warn("aPARAtus: requestSort not found on file explorer view");return}let r=(0,u.normalizePath)(this.settings.projectsPath),n=this;console.log("aPARAtus: Installing sorting patch for",r,"with order",this.settings.projectSortOrder),this.sortingPatchUninstaller=Y(e.constructor.prototype,{getSortedFolderItems(a){return function(l){if(l.path!==r)return(l.path.includes("Projects")||l.path.includes("1 -"))&&console.log("aPARAtus: Checking folder:",JSON.stringify(l.path),"vs configured:",JSON.stringify(r),"match:",l.path===r),a.call(this,l);console.log("aPARAtus: Sorting Projects folder, order:",n.settings.projectSortOrder);try{let o=a.call(this,l);return console.log("aPARAtus: Items type:",typeof o,Array.isArray(o)),o.length>0&&(console.log("aPARAtus: First item:",o[0]),console.log("aPARAtus: First item keys:",Object.keys(o[0])),console.log("aPARAtus: First item.file:",o[0].file)),n.sortProjectItems(o)}catch(o){return console.error("aPARAtus: Sorting failed, using default",o),a.call(this,l)}}}})}sortProjectItems(t){let e=[...t];if(this.settings.projectSortOrder==="lastModified")e.sort((r,n)=>{let a=r.file,l=n.file,o=a instanceof u.TFolder?U(a):a.stat?.mtime??0,c=l instanceof u.TFolder?U(l):l.stat?.mtime??0;return X({mtime:o},{mtime:c})});else if(this.settings.projectSortOrder==="datePrefix"){let r=J(this.settings.projectFolderFormat);console.log("aPARAtus: Date format extracted:",JSON.stringify(r),"from",JSON.stringify(this.settings.projectFolderFormat)),e.sort((n,a)=>{let l=n.file,o=a.file,c=window.moment(l.name,r),g=window.moment(o.name,r);console.log("aPARAtus: Parsing",l.name,"\u2192",c.isValid()?c.format("YYYY-MM-DD"):"INVALID");let f=c.isValid(),w=g.isValid();return f&&w?g.valueOf()-c.valueOf():f&&!w?-1:!f&&w?1:0})}return e}async archiveItem(t){if(this.archivingItems.has(t.path))return;this.archivingItems.add(t.path);let e=(0,u.normalizePath)(this.settings.archivePath),r=R(t.path);try{let a=this.getSourceFolders().find(f=>b(t.path,f)),l=a?R(a):"";await I(this.app,e);let o=l?(0,u.normalizePath)(`${e}/${l}`):e;await I(this.app,o);let c=z(this.app,o),g=k(o,r,c);if(this.settings.confirmBeforeArchive)return new Promise(f=>{new L(this.app,r,g,async()=>{await this.performArchive(t,g,r,o,a),f()},()=>f()).open()});await this.performArchive(t,g,r,o,a)}catch(n){let a=n instanceof Error?n.message:"Unknown error";new u.Notice(`Failed to archive "${r}": ${a}`),console.error("aPARAtus: Failed to archive item",n)}finally{this.archivingItems.delete(t.path)}}async performArchive(t,e,r,n,a){let l=e;for(let o=0;o<Z;o++)try{await this.app.vault.rename(t,e);break}catch(c){if(o===Z-1)throw c;let g=z(this.app,n);g.add(e),e=k(n,r,g)}e!==l?new u.Notice(`Archived "${r}" to ${e} (path changed due to conflict)`):new u.Notice(`Archived "${r}" to ${e}`),this.settings.focusAfterArchive&&a&&await Q(this.app,a)}};
